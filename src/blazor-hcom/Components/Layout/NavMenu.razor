<!-- TODO: Do a manual test for this feature when the App is deployed via a mobile
web browser. -->

@inject IMessageService NotifySrvs
@inject IJSRuntime JS
@using blazor_hcom.Classes

<nav class="navbar navbar-dark navbar-expand-md bg-primary border-bottom shadow mb-3 fixed-top">
	<div class="container-fluid">
        @* Toggler button for mobile *@
		<button class="navbar-toggler me-2" type="button" id="btn_toggler"
				aria-controls="navbarCollapse"
				aria-expanded="false" aria-label="Toggle navigation"
				data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
			<span class="navbar-toggler-icon"></span>
		</button>

		<a class="navbar-brand" href="">HCOM</a>
		
        @* Collapsible container *@
		<div class="collapse navbar-collapse" id="navbarCollapse">
			<div class="navbar-nav">
				<!-- Dynamically created links via Blazor with a special functionality for mobile viewers. -->
				@foreach (var item in NavItems)
				{
					<NavLink class="nav-link" href="@item.Href"
							Match="@item.Match" 
					>
						@item.Text
					</NavLink>
				}
			</div>
		</div>
		<button type="button" class="btn btn-primary position-relative ms-auto rounded-circle shadow-sm">
			<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
				fill="currentColor" viewBox="0 0 24 24">
				<path d="M12 2a7 7 0 0 1 7 7v4.5c0 .9.3 1.8.9 2.5l.4.5c.5.6.1 1.5-.7 1.5H4.4c-.8 0-1.2-.9-.7-1.5l.4-.5c.6-.7.9-1.6.9-2.5V9a7 7 0 0 1 7-7z"/>
				<circle cx="12" cy="20" r="1.3"/>
			</svg>

			@if (Messages.Count > 0)
			{
				<span class="position-absolute top-0 start-100 translate-middle p-1 bg-danger border border-light rounded-pill">
					<span class="visually-hidden">New alerts</span>
				</span>
			}
		</button>
	</div>
</nav>
@code {
	// Provide the Menu Items as Item with links
	private List<NavItem> NavItems = new()
	{
		new NavItem("Home", "/", NavLinkMatch.All),
		new NavItem("Counter", "/counter"),
		new NavItem("Weather", "/weather"),
		new NavItem("Dummy", "/dummies")
	};
	
	// Class for NavItem with default constructor
	public class NavItem
	{
		// Properties
		public string Text { get; }
		public string Href { get; }
		public NavLinkMatch Match { get; }

		// Constructor
		public NavItem(string text, string href, NavLinkMatch match=NavLinkMatch.Prefix)
		{
			Text = text;
			Href = href;
			Match = match;
		}
	}
	@* Expose messages from the MessageService *@
	private IReadOnlyList<AppMessage> Messages => NotifySrvs.Messages;

	protected override void OnInitialized()
	{
		NotifySrvs.OnMessagesChanged += Notify;
	}

	private async Task Notify()
	{
		await InvokeAsync(StateHasChanged);
	}

	public void Dispose()
	{
		NotifySrvs.OnMessagesChanged -= Notify;
	}


	/* private async Task ToggleToastContainer () {
		await JS.InvokeVoidAsync("toggleToastContainer", "all_msgs_toast_container");
			} */

}
